let lastFrameTime = 0;
const fps = 30;
const frameDuration = 1000 / fps;

function draw(timestamp) {
  if (!playing) return;

  if (!timestamp) timestamp = performance.now();
  const delta = timestamp - lastFrameTime;

  if (delta >= frameDuration) {
    lastFrameTime = timestamp;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    doudous.forEach(d => {
      ctx.drawImage(d.img, d.x, d.y, imgSize, imgSize);
      d.x += d.dx;
      d.y += d.dy;
      if (d.x < 0 || d.x > canvas.width - imgSize) d.dx *= -1;
      if (d.y < 0 || d.y > canvas.height - imgSize) d.dy *= -1;
    });
  }

  requestAnimationFrame(draw);
}
